<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 5.2.7.2 (Linux)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changedby" content="Mark Grant"/>
	<meta name="changed" content="2018-04-28T09:06:21.975593905"/>
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2017-03-05T15:10:09.151688590">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2017-03-05T14:51:06.695913719">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2017-03-05T13:47:32.560191287">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="00:00:00">
	<meta name="created" content="2015-12-12T10:21:56.092369819">
	<meta name="changed" content="2015-12-12T11:01:12.005574925">
	<style type="text/css">
		@page { margin: 2cm }
		p { margin-bottom: 0.25cm; line-height: 120% }
		h1 { margin-bottom: 0.21cm }
		h1.western { font-family: "Liberation Sans", sans-serif; font-size: 18pt }
		h1.cjk { font-family: "Droid Sans Fallback"; font-size: 18pt }
		h1.ctl { font-family: "FreeSans"; font-size: 18pt }
		a:link { so-language: zxx }
	</style>
</head>
<body lang="en-GB" dir="ltr">
<h1 class="western" align="center">General Deployment Preparation
Guide</h1>
<p align="left"><br/>
<br/>

</p>
<ol>
	<li/>
<p align="left">Ensure project builds correctly.</p>
	<ol type="a">
		<li/>
<p align="left">Move to the project build directory.
		(project_root/build).</p>
		<li/>
<p align="left">Ensure you are on the correct git branch.</p>
		<ul>
			<li/>
<p align="left">‘git checkout mg’</p>
		</ul>
		<li/>
<p align="left">Either run normal make sequence (with
		acmbuild.sh installed).</p>
		<ul>
			<li/>
<p align="left">‘acmbuild.sh -m (or --make) ..’</p>
		</ul>
		<li/>
<p align="left">Or run normal make sequence (without
		acmbuild.sh installed).</p>
		<ul>
			<li/>
<p align="left">‘autoreconf -if ..’</p>
			<li/>
<p align="left">‘../configure (--enable-silent-rules=yes)’</p>
			<li/>
<p align="left">‘make (--quiet or -s)’</p>
		</ul>
		<li/>
<p align="left">Clean-up</p>
		<ul>
			<li/>
<p align="left">‘make distclean’</p>
		</ul>
	</ol>
	<li/>
<p align="left">Test build a distribution and test install.</p>
	<ol type="a">
		<li/>
<p align="left">With acmbuild.sh installed.</p>
		<ul>
			<li/>
<p align="left">If the project allows a fakeroot, i.e. it
			does not hard-code paths (e.g. to /etc/….)</p>
			<ul>
				<li/>
<p align="left">‘acmbuild.sh -c (or --distcheck) ..’</p>
			</ul>
			<li/>
<p align="left">If the project does do some path hard-coding</p>
			<ul>
				<li/>
<p align="left">‘acmbuild.sh -f (or --distcheckfake) ..’</p>
			</ul>
		</ul>
		<li/>
<p align="left">Without acmbuild.sh installed.</p>
		<ul>
			<li/>
<p align="left">If the project allows a fakeroot, i.e. it
			does not hard-code paths 
			</p>
			<ul>
				<li/>
<p align="left">‘autoreconf -if ..’</p>
				<li/>
<p align="left">‘../configure
				(--enable-silent-rules=yes)’</p>
				<li/>
<p align="left">‘make (--quiet or -s) distcheck’</p>
			</ul>
			<li/>
<p align="left">If the project does do some path hard-coding</p>
			<ul>
				<li/>
<p align="left">‘autoreconf -if ..’</p>
				<li/>
<p align="left">‘../configure --enable-distcheck=yes
				(--enable-silent-rules=yes)’</p>
				<li/>
<p align="left">‘make (--quiet or -s) distcheck
				DISTCHECK_CONFIGURE_FLAGS=--enable-distcheck=yes’</p>
			</ul>
		</ul>
		<li/>
<p align="left">Clean-up</p>
		<ul>
			<li/>
<p align="left">‘rm *.tar.gz’</p>
		</ul>
	</ol>
	<li/>
<p align="left">Update git.</p>
	<ol type="a">
		<li/>
<p align="left">Ensure the git development branch is
		up-to-date.</p>
		<li/>
<p align="left">Ensure all git commits have been made.</p>
		<li/>
<p align="left">Ensure all commits are pushed.</p>
		<ul>
			<li/>
<p align="left">‘git push’</p>
		</ul>
		<li/>
<p align="left">Update the git master branch</p>
		<ul>
			<li/>
<p align="left">‘git checkout master’</p>
			<li/>
<p align="left">‘git merge mg’</p>
			<li/>
<p align="left">‘git push’</p>
			<li/>
<p align="left">‘git tag -as v1.0.1 -m 'Release of version
			1.0.1'’</p>
			<li/>
<p align="left">‘git push –tags’</p>
		</ul>
		<li/>
<p align="left">Move back to development branch.</p>
		<ul>
			<li/>
<p align="left">‘git checkout mg’</p>
		</ul>
	</ol>
	<li/>
<p align="left">To build a source tarball. (For a distribution
	tarball see the next section).</p>
	<ol type="a">
		<li/>
<p align="left">If acmbuild.sh is installed.</p>
		<ul>
			<li/>
<p align="left">‘acmbuild.sh -t (or --source-tarball) ..’</p>
		</ul>
		<li/>
<p align="left">If acmbuild.sh is not installed.</p>
		<ul>
			<li/>
<p align="left">‘autoreconf -if ..’</p>
			<li/>
<p align="left">‘../configure (use
			--enable-silent-rules=yes if you wish)’</p>
			<li/>
<p align="left">‘make (--quiet or -s) srctarball
			distclean’</p>
		</ul>
	</ol>
	<li/>
<p align="left">To build a distribution tarball.</p>
	<ol type="a">
		<li/>
<p align="left">If acmbuild.sh is installed.</p>
		<ul>
			<li/>
<p align="left">‘acmbuild.sh -D (or --dist) ..’</p>
		</ul>
		<li/>
<p align="left">If acmbuild.sh is not installed.</p>
		<ul>
			<li/>
<p align="left">‘autoreconf -if ..’</p>
			<li/>
<p align="left">‘../configure (use
			--enable-silent-rules=yes if you wish)’</p>
			<li/>
<p align="left">‘make (--quiet or -s) dist distclean’</p>
		</ul>
	</ol>
	<li/>
<p align="left">Copy tarball to deployment server.</p>
	<ol type="a">
		<li/>
<p align="left">‘scp *.tar.gz <a href="mailto:mgranthermes@hermes">mgranthermes@hermes</a>:staging’</p>
	</ol>
	<li/>
<p align="left">Install in deployment location on deployment
	server.</p>
	<ol type="a">
		<li/>
<p align="left">Logon to the deployment hosting machine</p>
		<ul>
			<li/>
<p align="left">‘ssh mgranthermes@hermes’</p>
		</ul>
		<li/>
<p align="left">Move to the directory used above.</p>
		<ul>
			<li/>
<p align="left">‘cd staging’</p>
		</ul>
		<li/>
<p align="left">If it is a source tarball move it to the
		source deployment directory.</p>
		<ul>
			<li/>
<p align="left">‘sudo cp -v * /srv/deployments/source’</p>
		</ul>
		<li/>
<p align="left">If it is a distribution tarball move it to
		the distribution deployment directory.</p>
		<ul>
			<li/>
<p align="left">‘sudo cp -v *
			/srv/deployments/distribution’</p>
		</ul>
		<li/>
<p align="left">Remove the staged file.</p>
		<ul>
			<li/>
<p align="left">‘rm -v *’</p>
		</ul>
	</ol>
</ol>
</body>
</html>