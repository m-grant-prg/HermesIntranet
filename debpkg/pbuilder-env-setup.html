<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 5.2.7.2 (Linux)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changedby" content="Mark Grant"/>
	<meta name="changed" content="2018-03-13T11:25:53.460955775"/>
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T11:19:30.875992722">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T11:17:32.156939010">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T11:15:03.818383921">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T11:05:29.353739814">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T10:51:44.818648297">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T10:26:42.515479275">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T10:16:18.687219845">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T09:52:52.567674370">
	<meta name="created" content="00:00:00">
	<meta name="changedby" content="Mark Grant">
	<meta name="changed" content="2018-03-13T09:50:34.003211790">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2018-02-15T15:00:05.201390473">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2018-02-15T14:56:32.083956496">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2017-09-08T15:30:25.555826964">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2017-08-18T14:26:38.023683795">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2017-08-17T15:27:16.322418541">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2017-06-20T13:29:03.249866213">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2015-12-12T13:54:38.166937920">
	<meta name="created" content="00:00:00">
	<meta name="changed" content="2015-12-12T13:52:29.946581735">
	<meta name="created" content="2015-12-12T13:33:41.059217339">
	<meta name="changed" content="2015-12-12T13:51:02.247295351">
	<style type="text/css">
		@page { margin: 2cm }
		p { margin-bottom: 0.25cm; line-height: 120% }
		h1 { margin-bottom: 0.21cm }
		h1.western { font-family: "Liberation Sans", sans-serif; font-size: 18pt }
		h1.cjk { font-family: "Droid Sans Fallback"; font-size: 18pt }
		h1.ctl { font-family: "FreeSans"; font-size: 18pt }
	</style>
</head>
<body lang="en-GB" dir="ltr">
<h1 class="western" align="center">pbuilder Environment Setup Guide</h1>
<p align="left"><br/>
<br/>

</p>
<ol>
	<li/>
<p align="left">Set-up .pbuilderrc. (See an example <a href="http://hermes/debpkg/pbuilderrc">here</a>.):-</p>
	<ol type="a">
		<li/>
<p align="left">pbuilder always needs root privileges so it
		will look for .pbuilderrc in /root. This is inconvenient, so you
		could set up a symlink in /root to point at a .pbuilderrc somewhere
		in your home directory.</p>
		<li/>
<p align="left">PPA's can be added later in the chroot
		environment itself. In this file add other repositories to the
		OTHERMIRROR variable.</p>
		<ul>
			<li/>
<p align="left">OTHERMIRROR=&quot;deb http://hermes/aptrepo
			stretch stable&quot;</p>
		</ul>
		<li/>
<p align="left">Add any additional APT keyrings.</p>
		<li/>
<p align="left">Add distribution dependent elements.</p>
		<ul>
			<li/>
<p align="left">Mirrors.</p>
			<li/>
<p align="left">Components</p>
			<li/>
<p align="left">DEBOOTSTRAPOPTS such as additional keyrings.</p>
		</ul>
		<li/>
<p align="left">Add additional packages to be automatically
		included in the base tarball.</p>
		<ul>
			<li/>
<p align="left">software-properties-common for adding PPAs.</p>
			<li/>
<p align="left">wget, gnupg2 and dirmngr for key handling.</p>
		</ul>
		<li/>
<p align="left">If supporting cross-builds then set any
		emulators needed in DEBOOTSTRAP.</p>
		<li/>
<p align="left">Aptitude is the default dependency resolver
		for pbuilder but it does not work when cross-building for arm, so
		use apt:-</p>
		<ul>
			<li/>
<p align="left">PBUILDERSATISFYDEPENDSCMD=/usr/lib/pbuilder/pbuilder-satisfydepends-apt</p>
			<li/>
<p align="left">(This also needs the qemu-user-static
			package installed).</p>
		</ul>
		<li/>
<p align="left">Set up various directories to use.</p>
		<li/>
<p align="left">Save the file.</p>
	</ol>
	<li/>
<p align="left">Create any hook files you want. e.g.:-</p>
	<ol type="a">
		<li/>
<p align="left">A <a href="http://hermes/debpkg/D40-gpgv-check-dsc">script</a>
		to run gpgv against all .dsc files prior to build.</p>
		<li/>
<p align="left">A <a href="http://hermes/debpkg/D60-apt-get-update">script</a>
		to run apt-get update before every build.</p>
		<li/>
<p align="left">A <a href="http://hermes/debpkg/E50-trustedkeys-kbx">script</a>
		to install your own gpg key when creating or updating a base
		tarball.</p>
		<li/>
<p align="left">A <a href="http://hermes/debpkg/H50-gpgv-warning">script</a>
		to print a warning that the standard gpgv check does not work.</p>
	</ol>
	<li/>
<p align="left">Create the distribution base tarball.</p>
	<ol type="a">
		<li/>
<p align="left">sudo OS=raspbian DIST=stretch ARCH=armhf
		pbuilder create --override-config</p>
	</ol>
	<li/>
<p align="left">If adding a PPA configure the chroot
	environment.</p>
	<ol type="a">
		<li/>
<p align="left">If you added the extra packages above skip to
		4.d. If doing this for the first time for a distribution you will
		need the output of the following command.</p>
		<ul>
			<li/>
<p align="left">dpkg-query -S $(which add-apt-repository)</p>
			<li/>
<p align="left">Output will be like:-</p>
			<ul>
				<p align="left">software-properties-common:
				/usr/bin/add-apt-repository</p>
			</ul>
		</ul>
		<li/>
<p align="left">Enter the pbuilder chroot.</p>
	</ol>
</ol>
<ol>
	<ol type="a">
		<ul>
			<li/>
<p align="left">sudo OS=raspbian DIST=stretch ARCH=armhf
			pbuilder login --save-after-login --override-config</p>
		</ul>
	</ol>
</ol>
<ol>
	<ol type="a" start="3">
		<li/>
<p align="left">If doing this for the first time for a
		distribution.</p>
		<ul>
			<li/>
<p align="left">apt-get install software-properties-common</p>
			<li/>
<p align="left">apt-get install wget</p>
			<li/>
<p align="left">apt-get install gnupg2</p>
		</ul>
		<li/>
<p align="left">Add the required PPA repositories.</p>
		<ul>
			<li/>
<p align="left">add-apt-repository ppa:m-grant-prg/utils</p>
		</ul>
		<li/>
<p align="left">Add the other repositories and get their
		keys.</p>
		<ul>
			<li/>
<p align="left">add-apt-repository 'deb
			http://hermes/aptrepo/ stretch stable'</p>
		</ul>
	</ol>
</ol>
<ol>
	<ol type="a">
		<ul>
			<li/>
<p align="left">wget -O -
			<a href="http://hermes/aptrepo/conf/hermes-apt.gpg.key">http://hermes/aptrepo/conf/hermes.gpg</a>|apt-key
			add -</p>
		</ul>
	</ol>
</ol>
<ol>
	<ol type="a" start="6">
		<li/>
<p align="left">Exit chroot environment.</p>
		<ul>
			<li/>
<p align="left">exit</p>
		</ul>
		<li/>
<p align="left">Update the base package.</p>
	</ol>
</ol>
<ol>
	<ol type="a" start="6">
		<ul>
			<li/>
<p align="left">sudo OS=raspbian DIST=stretch ARCH=armhf
			pbuilder update --override-config</p>
		</ul>
	</ol>
</ol>
</body>
</html>