Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2022-12-05T15:08:45+00:00

====== APT Package Preparation Using git-buildpackage ======
Updated Friday 09 December 2022

===== Initial Setup =====
1. Create a git repo on hermes in the usual way but use:-
	1. sudo git init--bare --initial-branch=upstream/latest
2. Create the local git working copy.
	1. Use git init --initial-branch=upstream/latest
3. Download a tarball
	1. Change the name from gip-3.29.tar.gz to gip_3.29.orig.tar.gz
4. Import the tarball.
	1. gbp import-orig --debian-branch=debian/latest --upstream-branch=upstream/latest ~/Downloads/gip_3.29.orig.tar.gz
5. Get upstream.
	1. git remote add upstream git@github.com:get-iplayer/get_iplayer.git
	2. git switch -c upstream/latest
	3. git fetch upstream
6. If upstream does not have gitignore etc
	1. Copy the files in.
	2. Replace .git/info/exclude with a file similar to [[./exclude|this]]
7. Setup origin
	1. git remote add origin
	2. git push
	3. set tracking as suggested.
8. Setup LaunchPad
	a. git remote add lp
	b. git push lp
9. Setup GitHub
	a. git remote add github
	b. Get on github, settings, branches and set default branch as upstream/latest
	c. git push github

===== New upstream release =====
1. git fetch upstream
2. Get the tarball and import
	a. gbp import-orig --uscan --upstream-branch=upstream/latest --debian-branch=debian/latest --upstream-vcs-tag=v3.30
	b. Note. Above seems to need the vcs-tag to import the history.
3. Sort the changelog
	a. dch -i
	b. Edit changelog
	c. dch -r
4. git commit -as as v3.30-1+deb11u1
5. gbp tag
6. git pushes etc

===== Create a new packaging branch sharing upstream/latest =====
1. git switch upstream/latest
2. git switch -c debian/latest
3. Add the Debian packaging directory
4. Add [[./gbp.conf|debian/gbp.conf]] (Ubuntu version shown, Debian does not need the tag).
5. git add .
6. git commit -as
7. gbp tag
8. git pushes and tag pushes

===== New upstream release for branch sharing upstream/latest =====
1. git merge v3.30 (the upstream tag).
2. Sort the changelog
	a. dch -i
	b. Edit changelog
	c. dch -r
3. git commit -as as v3.30-1ubuntu22.04u1
4. gbp tag
5. git pushes etc
