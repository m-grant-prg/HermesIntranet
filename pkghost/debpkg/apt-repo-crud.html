<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 7.0.4.2 (Linux)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changedby" content="Mark Grant"/>
	<meta name="changed" content="2022-01-19T16:05:46.936298265"/>
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<style type="text/css">
		@page { size: 21cm 29.7cm; margin: 2cm }
		p { margin-bottom: 0.25cm; background: transparent; line-height: 120%; background: transparent }
		h1 { margin-bottom: 0.21cm; background: transparent; background: transparent; page-break-after: avoid }
		h1.western { font-family: "Liberation Sans", sans-serif; font-size: 18pt; font-weight: bold }
		h1.cjk { font-family: "Droid Sans Fallback"; font-size: 18pt; font-weight: bold }
		h1.ctl { font-family: "FreeSans"; font-size: 18pt; font-weight: bold }
		a:link { color: #000080; so-language: zxx; text-decoration: underline }
		a:visited { color: #800000; so-language: zxx; text-decoration: underline }
	</style>
</head>
<body lang="en-GB" link="#000080" vlink="#800000" dir="ltr"><h1 class="western" align="center">
Create Update And Consume An APT Repository</h1>
<p align="left"><br/>
<br/>

</p>
<ol>
	<li><p align="left">If you don’t already have one, a GPG key must
	be created.</p>
	<ol type="a">
		<li><p align="left">gpg --gen-key</p>
	</ol>
	<li><p align="left">If your key has expired or needs editing.</p>
	<ol type="a">
		<li><p align="left">gpg --list-keys</p>
		<ul>
			<li><p align="left">Observe the pub id</p>
		</ul>
		<li><p align="left">gpg --edit-key pub id</p>
		<ul>
			<li><p align="left">gpg&gt; expire</p>
			<ul>
				<li><p align="left">Follow prompts to enter an expiration length.</p>
			</ul>
			<li><p align="left">gpg&gt; save</p>
		</ul>
	</ol>
	<li><p align="left">If you are creating a new repository or have
	edited the key, then the repo’s gpg key must be installed.</p>
	<ol type="a">
		<li><p align="left">Create the repo signing key.</p>
		<ul>
			<li><p align="left">gpg --output hermes.gpg --export
			<a href="mailto:mgrant@hermes.mgent.home">mgrant@hermes.mgent.home</a></p>
		</ul>
		<li><p align="left">reprepro uses sudo so we must make the key
		available to it as well</p>
		<ul>
			<li><p align="left">gpg --export-secret-keys --output secret</p>
			<li><p align="left">sudo gpg --import secret</p>
			<li><p align="left">rm secret</p>
		</ul>
		<li><p align="left">Move the key to the desired location in the new
		repo</p>
		<ul>
			<li><p align="left">sudo cp -v hermes.gpg /srv/repos/package/apt</p>
			<li><p align="left">rm hermes.gpg</p>
		</ul>
	</ol>
	<li><p align="left">To create a distribution within the repository.</p>
	<ol type="a">
		<li><p align="left">Add the distribution information to the
		distributions file.</p>
		<ul>
			<li><p align="left">sudo vim
			/srv/repos/package/apt/debian/conf/distributions</p>
			<li><p align="left">Add the distribution block.</p>
			<ul>
				<li><p align="left">Codename: stretch</p>
				<li><p align="left">Components: local</p>
				<li><p align="left">Architectures: i386 amd64</p>
				<li><p align="left">SignWith: default</p>
			</ul>
		</ul>
		<li><p align="left">Generate all index files for the distribution.</p>
		<ul>
			<li><p align="left">sudo reprepro -vb
			/srv/repos/package/apt/debian export stretch</p>
		</ul>
	</ol>
	<li><p align="left">To use the repository on a client.</p>
	<ol type="a">
		<li><p align="left">Add the repository.</p>
		<ul>
			<li><p align="left">sudo add-apt-repository 'deb
			http://hermes/aptrepos/debian/ stretch local'</p>
		</ul>
		<li><p align="left">Get the repository’s signing key.</p>
		<ul>
			<li><p align="left">wget -O -
			<a href="http://hermes/aptrepo/conf/hermes-apt.gpg.key">http://hermes/aptrepos/debian/conf/hermes.gpg</a>|sudo
			apt-key add -</p>
		</ul>
		<li><p align="left">And update.</p>
		<ul>
			<li><p align="left">sudo apt-get update</p>
		</ul>
	</ol>
</ol>
</body>
</html>