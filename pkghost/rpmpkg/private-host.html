<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 7.0.4.2 (Linux)"/>
	<meta name="created" content="2015-12-12T09:37:03.193001702"/>
	<meta name="changedby" content="Mark Grant"/>
	<meta name="changed" content="2022-01-13T15:43:19.058811608"/>
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<meta name="created" content="00:00:00">
	<style type="text/css">
		@page { size: 21cm 29.7cm; margin: 2cm }
		p { margin-bottom: 0.25cm; background: transparent; line-height: 120%; background: transparent }
		h1 { margin-bottom: 0.21cm; background: transparent; background: transparent; page-break-after: avoid }
		h1.western { font-family: "Liberation Sans", sans-serif; font-size: 18pt; font-weight: bold }
		h1.cjk { font-family: "Droid Sans Fallback"; font-size: 18pt; font-weight: bold }
		h1.ctl { font-family: "FreeSans"; font-size: 18pt; font-weight: bold }
		a:link { color: #000080; so-language: zxx; text-decoration: underline }
		a:visited { color: #800000; so-language: zxx; text-decoration: underline }
	</style>
</head>
<body lang="en-GB" link="#000080" vlink="#800000" dir="ltr"><h1 class="western" align="center">
Private Hosting Of rpm Package</h1>
<p align="left"><br/>
<br/>

</p>
<ol>
	<li><p align="left">Change to the osc output directory.</p>
	<li><p align="left">Copy the rpm file to a user-writable location
	and cd to it.</p>
	<li><p align="left">The package must be signed by the hermes key.
	rpmsign must also be configured. If this is already set up then go
	to (4).</p>
	<ol type="a">
		<li><p align="left">ssh <a href="mailto:mgrant@hermes">mgrant@hermes</a></p>
		<li><p align="left">Find the secret key</p>
		<ul>
			<li><p align="left">gpg --list-secret-keys</p>
			<li><p align="left">gpg --export-secret-key
			510206ECCB18744A2B93A88E17F85093B76B53C7 &gt; private-key</p>
		</ul>
		<li><p align="left">Transfer the key back to client machine</p>
		<ul>
			<li><p align="left">sftp the file private-key</p>
		</ul>
		<li><p align="left">Back on client machine</p>
		<li><p align="left">gpg --import private-key</p>
		<li><p align="left">Tell rpmsign which key to use</p>
		<ul>
			<li><p align="left">vim ~/.rpmmacros</p>
			<li><p align="left">Ensure the following line exists</p>
			<ul>
				<li><p align="left">%_gpg_name Mark Grant
				&lt;mgrant@hermes.mgent.home&gt;</p>
			</ul>
		</ul>
		<li><p align="left">Retrieve hermes public key</p>
		<ul>
			<li><p align="left">gpg --receive-keys 17F85093B76B53C7</p>
		</ul>
	</ol>
	<li><p align="left">Sign the package.</p>
	<ol type="a">
		<li><p align="left">rpmsign --addsign *.rpm</p>
	</ol>
	<li><p align="left">Copy the signed package to the server.</p>
	<ol type="a">
		<ul>
			<li><p align="left">scp *.rpm <a href="mailto:mgranthermes@hermes">mgrant@hermes</a>:staging</p>
		</ul>
	</ol>
	<li><p align="left">Install the rpm file in the repository.</p>
	<ol type="a">
		<li><p align="left">Logon to the rpm repository hosting machine</p>
		<ul>
			<li><p align="left">ssh mgrant@hermes</p>
		</ul>
		<li><p align="left">Move to the directory used above.</p>
		<ul>
			<li><p align="left">cd staging</p>
		</ul>
		<li><p align="left">Copy the rpm to the repo.</p>
		<ul>
			<li><p align="left">sudo cp -v *
			/srv/repos/package/rpm/opensuse/leap/15.1/beta/no-arch</p>
			<li><p align="left">(Fedora e.g. sudo cp -v *
			/srv/repos/package/rpm/fedora/30/stable/no-arch)</p>
		</ul>
		<li><p align="left">Re-build the repository</p>
		<ul>
			<li><p align="left">sudo createrepo_c -v
			/srv/repos/package/rpm/opensuse/leap/15.1/beta</p>
			<li><p align="left">(Fedora e.g. sudo createrepo_c -v
			/srv/repos/package/rpm/fedora/30/stable)</p>
		</ul>
	</ol>
	<li><p align="left">Remove the staged file.</p>
	<ol type="a">
		<li><p align="left">rm -v *</p>
	</ol>
</ol>
</body>
</html>